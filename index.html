<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StarShopList</title>
<style>
    body { font-family: Arial, sans-serif; background:#d5f8d4; margin:0; padding:10px; }

    /* Header */
    .header {
        text-align:center; 
        background:#007bff; 
        color:white; 
        padding:10px; 
        font-size:22px; 
        font-weight:bold;
        border-bottom-left-radius:10px;
        border-bottom-right-radius:10px;
        opacity:0.95;
    }

    /* Input Section */
    .input-section { 
        display:flex; 
        flex-direction:column; 
        gap:10px; 
        margin-top:15px; 
        align-items:center;
    }
    .item-box {
        width:85%;
        padding:12px; 
        border-radius:8px; 
        border:1px solid #aaa;
        font-size:16px;
    }
    .round-box {
        width:40%;
        padding:10px; 
        border-radius:15px; 
        border:1px solid #aaa;
        text-align:center;
        font-size:16px;
    }
    .add-btn {
        width:60px; height:60px;
        border-radius:50%;
        background:#007bff;
        color:white; font-size:18px;
        cursor:pointer; border:none;
    }

    table { width:100%; border-collapse:collapse; background:white; margin-top:10px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:#333; color:white; }

    /* Buttons bottom */
    .btn-row { text-align:center; margin-top:20px; }
    .btn-row button {
        padding:10px 15px; border:none;
        border-radius:8px; margin:5px;
        color:white; cursor:pointer; 
        font-weight:bold;
    }
    .export { background:#28a745; }
    .share { background:#ff9800; }
    .clear { background:#f44336; }
</style>
</head>
<body>

<div class="header">StarShopList – <span id="todayDate"></span></div>

<!-- INPUT SECTION -->
<div class="input-section">
    <input type="text" id="item" class="item-box" placeholder="Enter Item Name">
    
    <div style="display:flex; gap:10px;">
        <input type="text" id="qty" class="round-box" placeholder="Qty (Optional)">
        <input type="text" id="rate" class="round-box" placeholder="Rate (Optional)">
        <button class="add-btn" onclick="addItem()">+</button>
    </div>
</div>

<!-- TABLE -->
<table id="listTable">
    <thead>
        <tr>
            <th>✔</th>
            <th>Item</th>
            <th>Qty</th>
            <th>Rate</th>
            <th>Amount</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<h3 style="text-align:center;">Total Amount: ₹<span id="totalAmount">0</span></h3>

<!-- FOOTER BUTTONS -->
<div class="btn-row">
    <button class="export" onclick="exportCSV()">Export CSV</button>
    <button class="share" onclick="shareList()">Share</button>
    <button class="clear" onclick="clearAll()">Clear All</button>
</div>

<script>
    document.getElementById("todayDate").innerText =
        new Date().toLocaleDateString();

    let list = JSON.parse(localStorage.getItem("shopList")) || [];

    function save() { localStorage.setItem("shopList", JSON.stringify(list)); render(); }

    function addItem() {
        const item = document.getElementById("item").value.trim();
        let qty = document.getElementById("qty").value.trim();
        let rate = document.getElementById("rate").value.trim();

        if (!item) return alert("Item name is required!");

        if (qty && isNaN(qty)) return alert("Qty digit only!");
        if (rate && isNaN(rate)) return alert("Rate digit only!");

        qty = qty || "-";  
        rate = rate || "-";

        list.push({ item, qty, rate, done: false });
        save();
        
        document.getElementById("item").value = "";
        document.getElementById("qty").value = "";
        document.getElementById("rate").value = "";
    }

    function render() {
        const tbody = document.querySelector("#listTable tbody");
        tbody.innerHTML = "";
        let total = 0;

        list.forEach((data, i) => {
            let amount = (!isNaN(data.qty) && !isNaN(data.rate)) ? (data.qty * data.rate) : "-";
            if (amount !== "-") total += amount;

            const row = document.createElement("tr");
            row.innerHTML = `
                <td><input type="checkbox" ${data.done ? "checked" : ""} onchange="toggle(${i})"></td>
                <td>${data.item}</td>
                <td>${data.qty}</td>
                <td>${data.rate}</td>
                <td>${amount}</td>
            `;
            row.onclick = () => edit(i);
            tbody.appendChild(row);
        });
        document.getElementById("totalAmount").innerText = total;
    }

    function toggle(i) { list[i].done = !list[i].done; save(); }

    function edit(i) {
        const data = prompt("Edit: item,qty,rate", `${list[i].item},${list[i].qty},${list[i].rate}`);
        if (!data) return;
        const [item, qty, rate] = data.split(",");
        list[i] = { ...list[i], item, qty, rate };
        save();
    }

    function clearAll() { if (confirm("Clear all?")) list = []; save(); }

    function exportCSV() {
        let csv = "Item,Qty,Rate,Amount\n";
        list.forEach(a => {
            const amount = (!isNaN(a.qty) && !isNaN(a.rate)) ? (a.qty * a.rate) : "-";
            csv += `${a.item},${a.qty},${a.rate},${amount}\n`;
        });
        let link = document.createElement("a");
        link.href = "data:text/csv," + encodeURI(csv);
        link.download = "StarShopList.csv";
        link.click();
    }

    function shareList() {
        alert("Share via screenshot (Next version: WhatsApp share)");
    }

    render();
</script>
</body>
</html>
